<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Catur Online</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            flex: 1;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 10px;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 80px); /* Tinggi total dikurangi bottom nav */
        }

        /* ===== HEADER MINIMAL ===== */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            margin-bottom: 10px;
            flex-shrink: 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            color: #4cc9f0;
        }

        .logo i {
            font-size: 2rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #4cc9f0;
            cursor: pointer;
            background: linear-gradient(135deg, #4361ee 0%, #7209b7 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        #userDisplay {
            font-weight: bold;
            font-size: 1rem;
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-rank {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .rank-bronze { 
            background: linear-gradient(135deg, #CD7F32 0%, #B87333 100%); 
            color: white;
        }
        .rank-silver { 
            background: linear-gradient(135deg, #C0C0C0 0%, #A8A8A8 100%); 
            color: #333;
        }
        .rank-platinum { 
            background: linear-gradient(135deg, #E5E4E2 0%, #C0C0C0 100%); 
            color: #333;
        }
        .rank-master { 
            background: linear-gradient(135deg, #FFD700 0%, #D4AF37 100%); 
            color: #333;
        }
        .rank-supergrandmaster { 
            background: linear-gradient(135deg, #9d00ff 0%, #4a00e0 100%); 
            color: white;
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding-bottom: 10px;
        }

        /* ===== ADMIN HINTS ===== */
        .admin-hints {
            position: fixed;
            top: 70px;
            right: 20px;
            background: rgba(157, 0, 255, 0.2);
            border: 2px solid #9d00ff;
            border-radius: 10px;
            padding: 15px;
            width: 280px;
            z-index: 1001;
            backdrop-filter: blur(10px);
            display: none;
        }

        .admin-hints.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .admin-hints h4 {
            color: #9d00ff;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-hints ul {
            list-style: none;
            padding-left: 10px;
        }

        .admin-hints li {
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
        }

        .admin-hints li:before {
            content: "âœ“ ";
            color: #4cc9f0;
        }

        .toggle-hints-btn {
            position: fixed;
            top: 70px;
            right: 20px;
            background: #9d00ff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1002;
            box-shadow: 0 4px 15px rgba(157, 0, 255, 0.4);
        }

        /* ===== BOTTOM NAVIGATION ===== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 1000;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            height: 60px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            cursor: pointer;
            padding: 8px;
            border-radius: 10px;
            transition: all 0.3s;
            min-width: 60px;
            height: 50px;
        }

        .nav-item:hover {
            background: rgba(76, 201, 240, 0.2);
        }

        .nav-item.active {
            background: linear-gradient(135deg, #4361ee 0%, #3a56d4 100%);
            transform: translateY(-5px);
        }

        .nav-icon {
            font-size: 1.3rem;
        }

        .nav-label {
            font-size: 0.7rem;
            font-weight: bold;
        }

        /* ===== BUTTON STYLES ===== */
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, #4361ee 0%, #3a56d4 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #7209b7 0%, #5a08a1 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #4cc9f0 0%, #38b6ff 100%);
            color: #1a1a2e;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f72585 0%, #e01e75 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f8961e 0%, #f3722c 100%);
            color: white;
        }

        /* ===== LOBBY SECTION ===== */
        .lobby-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .lobby-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            align-items: center;
        }

        .room-code-input {
            display: flex;
            gap: 8px;
            flex: 1;
            max-width: 300px;
        }

        .room-code-input input {
            flex: 1;
            padding: 10px;
            border: 2px solid #4361ee;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 0.9rem;
            transition: border-color 0.3s;
        }

        .room-code-input input:focus {
            outline: none;
            border-color: #4cc9f0;
        }

        .active-games {
            flex: 1;
            overflow-y: auto;
        }

        .active-games h3 {
            margin-bottom: 15px;
            color: #4cc9f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .games-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 12px;
            margin-top: 10px;
        }

        .no-games {
            text-align: center;
            padding: 30px;
            color: rgba(255, 255, 255, 0.5);
            font-style: italic;
        }

        .game-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .game-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            border-color: #4cc9f0;
        }

        .game-card h4 {
            color: #4cc9f0;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .game-meta {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .game-status {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .status-waiting {
            background: rgba(248, 150, 30, 0.2);
            color: #f8961e;
        }

        .status-playing {
            background: rgba(76, 201, 240, 0.2);
            color: #4cc9f0;
        }

        /* ===== PROFIL SECTION ===== */
        .profile-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            height: 100%;
            overflow-y: auto;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(76, 201, 240, 0.3);
        }

        .profile-avatar {
            position: relative;
            width: 100px;
            height: 100px;
            flex-shrink: 0;
        }

        #profileImage {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #4cc9f0;
            background: linear-gradient(135deg, #4361ee 0%, #7209b7 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
        }

        .change-photo-btn {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: #4cc9f0;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.8rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }

        .profile-info h2 {
            color: #4cc9f0;
            margin-bottom: 8px;
            font-size: 1.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4cc9f0;
            margin-bottom: 5px;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8rem;
        }

        /* ===== CLAN SECTION ===== */
        .clan-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            height: 100%;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .clan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(76, 201, 240, 0.3);
        }

        .clan-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .clan-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #f8961e 0%, #f72585 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .clan-content {
            flex: 1;
            overflow-y: auto;
            padding-right: 5px;
        }

        .clan-id-display {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            color: #4cc9f0;
            margin: 15px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid rgba(76, 201, 240, 0.3);
            cursor: pointer;
            transition: all 0.3s;
        }

        .clan-id-display:hover {
            background: rgba(76, 201, 240, 0.2);
            transform: translateY(-2px);
        }

        .clan-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .create-clan-section, .join-clan-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .create-clan-section h4, .join-clan-section h4 {
            color: #4cc9f0;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .clan-input-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .clan-input-group input {
            flex: 1;
            padding: 10px;
            border: 2px solid #4361ee;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 0.9rem;
        }

        .clan-members {
            margin-top: 20px;
        }

        .clan-members h4 {
            color: #4cc9f0;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .members-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }

        .member-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .member-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #4361ee 0%, #4cc9f0 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .member-info {
            flex: 1;
        }

        .member-name {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .member-role {
            font-size: 0.8rem;
            color: #f8961e;
        }

        .no-clan-message {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255, 255, 255, 0.7);
        }

        .no-clan-message i {
            font-size: 3rem;
            color: #4cc9f0;
            margin-bottom: 15px;
        }

        /* ===== POINTS SECTION ===== */
        .points-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            height: 100%;
            overflow-y: auto;
        }

        .points-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(76, 201, 240, 0.3);
        }

        .points-display {
            text-align: center;
            margin-bottom: 30px;
        }

        .points-value {
            font-size: 3rem;
            font-weight: bold;
            color: #4cc9f0;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(76, 201, 240, 0.5);
        }

        .rank-progress {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .rank-stages {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            gap: 5px;
        }

        .rank-stage {
            text-align: center;
            flex: 1;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.8rem;
        }

        .rank-stage.active {
            background: rgba(76, 201, 240, 0.2);
            transform: scale(1.05);
        }

        .rank-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .rank-threshold {
            font-weight: bold;
            color: #f8961e;
            font-size: 0.9rem;
        }

        .progress-bar {
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4361ee 0%, #4cc9f0 100%);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .rank-requirements {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .rank-requirements h4 {
            color: #4cc9f0;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rank-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 12px;
        }

        .rank-item {
            text-align: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ===== GAME SECTION ===== */
        .game-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .game-header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(76, 201, 240, 0.3);
            flex-shrink: 0;
        }

        #gameTitle {
            color: #4cc9f0;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .game-info {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .game-info span {
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .game-area {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 15px;
            overflow: hidden;
        }

        /* ===== CHESSBOARD ===== */
        .chessboard-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            overflow: hidden;
        }

        #chessboard {
            width: 480px;
            height: 480px;
            display: grid;
            grid-template-columns: repeat(8, 60px);
            grid-template-rows: repeat(8, 60px);
            border: 3px solid #333;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            flex-shrink: 0;
        }

        .chess-square {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s;
            position: relative;
        }

        .chess-square:hover {
            transform: scale(1.05);
            z-index: 1;
        }

        .light-square {
            background-color: #f0d9b5;
        }

        .dark-square {
            background-color: #b58863;
        }

        .selected {
            box-shadow: inset 0 0 0 3px #4cc9f0;
        }

        .possible-move {
            position: absolute;
            width: 16px;
            height: 16px;
            background-color: rgba(76, 201, 240, 0.5);
            border-radius: 50%;
            pointer-events: none;
            top: 22px;
            left: 22px;
        }

        .board-controls {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* ===== GAME PANEL ===== */
        .game-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow: hidden;
        }

        .player-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            flex-shrink: 0;
        }

        .player {
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
            position: relative;
            overflow: hidden;
        }

        .player h4 {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
        }

        .white-player {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #333;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .black-player {
            background: linear-gradient(135deg, #212529 0%, #343a40 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .player-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-timer {
            font-size: 1.5rem;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            text-align: center;
            padding: 5px 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            min-width: 95px;
        }

        .white-player .player-timer {
            background: rgba(0, 0, 0, 0.1);
            color: #333;
        }

        .vs {
            text-align: center;
            font-weight: bold;
            font-size: 1rem;
            margin: 10px 0;
            color: #f8961e;
        }

        /* ===== CHAT BOX ===== */
        .chat-box {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            height: 250px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            flex-shrink: 0;
        }

        .chat-box h4 {
            margin-bottom: 12px;
            color: #4cc9f0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin: 10px 0;
            padding-right: 8px;
        }

        .chat-message {
            margin-bottom: 8px;
            padding: 6px 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            border-left: 3px solid #4cc9f0;
            font-size: 0.9rem;
        }

        .chat-message .username {
            font-weight: bold;
            color: #4cc9f0;
            margin-right: 6px;
        }

        .chat-message .time {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
            float: right;
        }

        .chat-input {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .chat-input input {
            flex: 1;
            padding: 8px;
            border: 2px solid #4361ee;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 0.9rem;
            transition: border-color 0.3s;
        }

        .chat-input input:focus {
            outline: none;
            border-color: #4cc9f0;
        }

        .chat-input button {
            padding: 8px 15px;
            min-width: auto;
        }

        /* ===== MOVE HISTORY ===== */
        .move-history {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            height: 250px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            flex-shrink: 0;
        }

        .move-history h4 {
            margin-bottom: 12px;
            color: #4cc9f0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
        }

        .moves-list {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-top: 10px;
        }

        .move-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 6px 10px;
            border-radius: 5px;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .move-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .move-number {
            color: #f8961e;
            font-weight: bold;
            margin-right: 5px;
        }

        /* ===== MODALS ===== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 25px;
            border-radius: 15px;
            min-width: 350px;
            max-width: 450px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(76, 201, 240, 0.2);
            animation: modalAppear 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-content h3 {
            color: #4cc9f0;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .modal-content input {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: 2px solid #4361ee;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 0.9rem;
            transition: border-color 0.3s;
        }

        .modal-content input:focus {
            outline: none;
            border-color: #4cc9f0;
        }

        .form-group {
            margin: 12px 0;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #4cc9f0;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 15px;
        }

        .room-code-display {
            font-size: 2rem;
            font-weight: bold;
            color: #4cc9f0;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            letter-spacing: 3px;
            background: rgba(76, 201, 240, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-shadow: 0 2px 10px rgba(76, 201, 240, 0.5);
            border: 2px solid rgba(76, 201, 240, 0.3);
        }

        .room-url {
            margin: 12px 0;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            word-break: break-all;
        }

        /* ===== UTILITY CLASSES ===== */
        .hidden {
            display: none !important;
        }

        /* ===== SCROLLBAR STYLING ===== */
        ::-webkit-scrollbar {
            width: 5px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: #4cc9f0;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #38b6ff;
        }

        /* ===== ADMIN BADGE ===== */
        .admin-badge {
            background: linear-gradient(135deg, #9d00ff 0%, #4a00e0 100%);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 5px;
            display: inline-block;
        }

        /* ===== ANIMATIONS ===== */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease;
        }

        /* ===== GAME STATUS INDICATORS ===== */
        .status-active {
            color: #4cc9f0 !important;
        }
        
        .status-check {
            color: #f72585 !important;
            animation: pulse 1s infinite;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 1200px) {
            .game-area {
                grid-template-columns: 1fr;
                max-width: 700px;
                margin: 0 auto;
            }
            
            #chessboard {
                width: 400px;
                height: 400px;
                grid-template-columns: repeat(8, 50px);
                grid-template-rows: repeat(8, 50px);
            }
            
            .chess-square {
                width: 50px;
                height: 50px;
                font-size: 35px;
            }
            
            .admin-hints {
                width: 250px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 8px;
            }
            
            .header {
                padding: 8px;
            }
            
            .logo {
                font-size: 1.3rem;
            }
            
            .logo i {
                font-size: 1.8rem;
            }
            
            .lobby-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .room-code-input {
                max-width: 100%;
                width: 100%;
            }
            
            .games-list {
                grid-template-columns: 1fr;
            }
            
            #chessboard {
                width: 320px;
                height: 320px;
                grid-template-columns: repeat(8, 40px);
                grid-template-rows: repeat(8, 40px);
            }
            
            .chess-square {
                width: 40px;
                height: 40px;
                font-size: 30px;
            }
            
            .player-timer {
                font-size: 1.3rem;
                min-width: 85px;
            }
            
            .modal-content {
                min-width: 90%;
                margin: 15px;
                padding: 20px 15px;
            }
            
            .moves-list {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .game-area {
                grid-template-columns: 1fr;
            }
            
            .members-list {
                grid-template-columns: 1fr;
            }
            
            .admin-hints {
                width: 200px;
                top: 60px;
                right: 10px;
            }
            
            .toggle-hints-btn {
                top: 60px;
                right: 10px;
            }
            
            .bottom-nav {
                height: 55px;
            }
            
            .nav-icon {
                font-size: 1.2rem;
            }
            
            .nav-label {
                font-size: 0.65rem;
            }
        }

        @media (max-width: 480px) {
            #chessboard {
                width: 280px;
                height: 280px;
                grid-template-columns: repeat(8, 35px);
                grid-template-rows: repeat(8, 35px);
            }
            
            .chess-square {
                width: 35px;
                height: 35px;
                font-size: 25px;
            }
            
            .player-details {
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
            }
            
            .player-timer {
                align-self: stretch;
                text-align: right;
                font-size: 1.2rem;
            }
            
            .moves-list {
                grid-template-columns: 1fr;
            }
            
            .room-code-input {
                flex-direction: column;
                align-items: center;
            }
            
            .bottom-nav {
                padding: 8px 0;
                height: 50px;
            }
            
            .nav-item {
                min-width: 55px;
                padding: 6px;
            }
            
            .nav-icon {
                font-size: 1.1rem;
            }
            
            .nav-label {
                font-size: 0.6rem;
            }
            
            .admin-hints {
                width: 180px;
                padding: 10px;
            }
            
            .game-panel {
                gap: 10px;
            }
            
            .chat-box, .move-history {
                height: 200px;
            }
        }

        @media (max-height: 700px) {
            .container {
                padding: 5px;
            }
            
            .header {
                padding: 5px 10px;
                margin-bottom: 5px;
            }
            
            .logo {
                font-size: 1.2rem;
            }
            
            .logo i {
                font-size: 1.5rem;
            }
            
            .profile-pic {
                width: 35px;
                height: 35px;
            }
            
            #chessboard {
                width: 320px;
                height: 320px;
                grid-template-columns: repeat(8, 40px);
                grid-template-rows: repeat(8, 40px);
            }
            
            .chess-square {
                width: 40px;
                height: 40px;
                font-size: 30px;
            }
            
            .chat-box, .move-history {
                height: 180px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <i class="fas fa-chess"></i>
            <span>Chess Online</span>
        </div>
        <div class="user-info">
            <div id="userDisplay">
                <div class="profile-pic" id="headerProfilePic">
                    <i class="fas fa-user"></i>
                </div>
                <span id="username">Guest</span>
                <span id="userRank" class="user-rank rank-bronze">Bronze</span>
            </div>
            <button id="authBtn" class="btn-primary">
                <i class="fas fa-sign-in-alt"></i> Login
            </button>
        </div>
    </header>

    <!-- Admin Hints Panel -->
    <button class="toggle-hints-btn hidden" id="toggleHintsBtn">
        <i class="fas fa-lightbulb"></i>
    </button>
    
    <div class="admin-hints hidden" id="adminHints">
        <h4><i class="fas fa-crown"></i> Admin Hints</h4>
        <ul>
            <li>Control the center squares (e4, d4, e5, d5)</li>
            <li>Develop knights and bishops early</li>
            <li>Castle your king to safety</li>
            <li>Don't move the same piece twice in opening</li>
            <li>Connect your rooks</li>
            <li>Watch for opponent's threats</li>
            <li>Trade pieces when you're ahead</li>
            <li>Use pawn breaks to open files</li>
        </ul>
        <p style="margin-top: 10px; color: #4cc9f0; font-size: 0.8rem;">
            <i class="fas fa-star"></i> Admin Mode Active!
        </p>
    </div>

    <!-- Main Content -->
    <div class="container">
        <main class="main-content">
            <!-- Lobby Section -->
            <div class="lobby-section" id="lobbySection">
                <div class="lobby-controls">
                    <button id="createGameBtn" class="btn-primary">
                        <i class="fas fa-plus"></i> Buat Game
                    </button>
                    <button id="joinRandomBtn" class="btn-secondary">
                        <i class="fas fa-random"></i> Random
                    </button>
                    <div class="room-code-input">
                        <input type="text" id="roomCodeInput" placeholder="Kode Room" maxlength="8">
                        <button id="joinRoomBtn" class="btn-success">
                            <i class="fas fa-door-open"></i> Join
                        </button>
                    </div>
                </div>

                <div class="active-games">
                    <h3><i class="fas fa-list"></i> Game Tersedia</h3>
                    <div class="games-list" id="gamesList">
                        <div class="no-games">
                            <i class="fas fa-chess-board fa-2x"></i>
                            <p>Tidak ada game yang tersedia</p>
                            <p>Buat game baru untuk memulai!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Section -->
            <div class="profile-section hidden" id="profileSection">
                <div class="profile-header">
                    <div class="profile-avatar">
                        <div id="profileImage">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="change-photo-btn" id="changePhotoBtn">
                            <i class="fas fa-camera"></i>
                        </div>
                        <input type="file" id="photoUpload" accept="image/*" style="display: none;">
                    </div>
                    <div class="profile-info">
                        <h2 id="profileUsername">Guest</h2>
                        <p>Member: <span id="memberSince">Today</span></p>
                        <div id="profileRank" class="user-rank rank-bronze">Bronze</div>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalGames">0</div>
                        <div class="stat-label">Total Games</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="gamesWon">0</div>
                        <div class="stat-label">Menang</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="gamesLost">0</div>
                        <div class="stat-label">Kalah</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="gamesDrawn">0</div>
                        <div class="stat-label">Seri</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="winRate">0%</div>
                        <div class="stat-label">Win Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="currentPoints">0</div>
                        <div class="stat-label">Points</div>
                    </div>
                </div>
            </div>

            <!-- Clan Section -->
            <div class="clan-section hidden" id="clanSection">
                <div class="clan-header">
                    <div class="clan-info">
                        <div class="clan-avatar">
                            <i class="fas fa-users"></i>
                        </div>
                        <div>
                            <h2 id="clanName">Tidak Ada Clan</h2>
                            <p id="clanMembers">Belum bergabung dengan clan</p>
                        </div>
                    </div>
                </div>
                
                <div class="clan-content" id="clanContent">
                    <!-- Jika user sudah punya clan -->
                    <div id="myClanSection" class="hidden">
                        <div class="clan-id-display" id="clanIdDisplay" title="Klik untuk copy ID Clan">
                            <span>Clan ID: <strong id="clanIdText">XXXXXX</strong></span>
                            <button class="btn-success" style="padding: 5px 10px; font-size: 0.8rem;">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                        </div>
                        
                        <div class="clan-members">
                            <h4><i class="fas fa-users"></i> Anggota Clan</h4>
                            <div class="members-list" id="clanMembersList">
                                <!-- Anggota clan akan diisi JavaScript -->
                            </div>
                        </div>
                        
                        <div class="clan-actions">
                            <button id="leaveClanBtn" class="btn-danger">
                                <i class="fas fa-sign-out-alt"></i> Keluar Clan
                            </button>
                            <button id="inviteClanBtn" class="btn-secondary">
                                <i class="fas fa-share"></i> Invite Teman
                            </button>
                        </div>
                    </div>
                    
                    <!-- Jika user belum punya clan -->
                    <div id="noClanSection">
                        <div class="no-clan-message">
                            <i class="fas fa-users fa-3x"></i>
                            <h3>Belum Bergabung dengan Clan</h3>
                            <p>Bergabunglah dengan clan untuk bermain bersama teman dan mendapatkan bonus points!</p>
                        </div>
                        
                        <div class="create-clan-section">
                            <h4><i class="fas fa-plus-circle"></i> Buat Clan Baru</h4>
                            <div class="clan-input-group">
                                <input type="text" id="clanNameInput" placeholder="Nama Clan" maxlength="20">
                                <button id="createClanBtn" class="btn-primary">
                                    <i class="fas fa-plus"></i> Buat
                                </button>
                            </div>
                        </div>
                        
                        <div class="join-clan-section">
                            <h4><i class="fas fa-sign-in-alt"></i> Gabung ke Clan</h4>
                            <p>Masukkan ID clan untuk bergabung:</p>
                            <div class="clan-input-group">
                                <input type="text" id="joinClanId" placeholder="Contoh: clan_123456">
                                <button id="joinClanBtn" class="btn-success">
                                    <i class="fas fa-check"></i> Gabung
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Points Section -->
            <div class="points-section hidden" id="pointsSection">
                <div class="points-header">
                    <h2><i class="fas fa-trophy"></i> Points & Rank</h2>
                </div>
                
                <div class="points-display">
                    <div class="points-value" id="totalPoints">0</div>
                    <p>Total Points</p>
                </div>
                
                <div class="rank-progress">
                    <h3>Rank Progress</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="rankProgress" style="width: 0%"></div>
                    </div>
                    <div class="rank-stages" id="rankStages">
                        <!-- Rank stages akan diisi JavaScript -->
                    </div>
                </div>
                
                <div class="rank-requirements">
                    <h4><i class="fas fa-medal"></i> Rank Requirements</h4>
                    <div class="rank-grid">
                        <div class="rank-item">
                            <div style="font-size: 2rem;">ðŸ¥‰</div>
                            <div style="font-weight: bold; color: #CD7F32;">Bronze</div>
                            <div>0 - 149 points</div>
                        </div>
                        <div class="rank-item">
                            <div style="font-size: 2rem;">ðŸ¥ˆ</div>
                            <div style="font-weight: bold; color: #C0C0C0;">Silver</div>
                            <div>150 - 499 points</div>
                        </div>
                        <div class="rank-item">
                            <div style="font-size: 2rem;">ðŸ¥‡</div>
                            <div style="font-weight: bold; color: #E5E4E2;">Platinum</div>
                            <div>500 - 999 points</div>
                        </div>
                        <div class="rank-item">
                            <div style="font-size: 2rem;">ðŸ‘‘</div>
                            <div style="font-weight: bold; color: #FFD700;">Master</div>
                            <div>1000+ points</div>
                        </div>
                        <div class="rank-item">
                            <div style="font-size: 2rem;">ðŸ†</div>
                            <div style="font-weight: bold; color: #9d00ff;">Super GM</div>
                            <div>999,999 points</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Game Area -->
            <div class="game-section hidden" id="gameSection">
                <div class="game-header">
                    <h2 id="gameTitle">Chess Game</h2>
                    <div class="game-info">
                        <span id="gameStatus" class="status-waiting">Waiting...</span>
                        <span id="roomCode">Room: --</span>
                    </div>
                </div>

                <div class="game-area">
                    <!-- Chessboard -->
                    <div class="chessboard-container">
                        <div id="chessboard"></div>
                        <div class="board-controls">
                            <button id="resignBtn" class="btn-danger">
                                <i class="fas fa-flag"></i> Resign
                            </button>
                            <button id="offerDrawBtn" class="btn-warning">
                                <i class="fas fa-handshake"></i> Draw
                            </button>
                            <button id="newGameBtn" class="btn-primary">
                                <i class="fas fa-redo"></i> New Game
                            </button>
                        </div>
                    </div>

                    <!-- Game Panel -->
                    <div class="game-panel">
                        <!-- Player Info -->
                        <div class="player-info">
                            <div class="player white-player">
                                <h4><i class="fas fa-chess-piece"></i> White</h4>
                                <div class="player-details">
                                    <span id="whitePlayer">Waiting...</span>
                                    <div class="player-timer" id="whiteTimer">10:00</div>
                                </div>
                            </div>
                            <div class="vs">VS</div>
                            <div class="player black-player">
                                <h4><i class="fas fa-chess-piece"></i> Black</h4>
                                <div class="player-details">
                                    <span id="blackPlayer">Waiting...</span>
                                    <div class="player-timer" id="blackTimer">10:00</div>
                                </div>
                            </div>
                        </div>

                        <!-- Chat Box -->
                        <div class="chat-box">
                            <h4><i class="fas fa-comments"></i> Chat</h4>
                            <div class="chat-messages" id="chatMessages">
                                <div class="chat-message">
                                    <span class="username">System:</span>
                                    <span class="message">Welcome to chess!</span>
                                    <span class="time">12:00</span>
                                </div>
                            </div>
                            <div class="chat-input">
                                <input type="text" id="chatInput" placeholder="Type message...">
                                <button id="sendChatBtn" class="btn-success">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Move History -->
                        <div class="move-history">
                            <h4><i class="fas fa-history"></i> Moves</h4>
                            <div class="moves-list" id="movesList">
                                <!-- Move history akan diisi JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <div class="nav-item active" id="navLobby">
            <div class="nav-icon">ðŸ </div>
            <div class="nav-label">Lobby</div>
        </div>
        <div class="nav-item" id="navProfile">
            <div class="nav-icon">ðŸ‘¤</div>
            <div class="nav-label">Profil</div>
        </div>
        <div class="nav-item" id="navClan">
            <div class="nav-icon">ðŸ‘¥</div>
            <div class="nav-label">Clan</div>
        </div>
        <div class="nav-item" id="navPoints">
            <div class="nav-icon">â­</div>
            <div class="nav-label">Rank</div>
        </div>
    </nav>

    <!-- Modals -->
    
    <!-- Login/Register Modal -->
    <div class="modal hidden" id="loginModal">
        <div class="modal-content">
            <h3><i class="fas fa-sign-in-alt"></i> Login / Register</h3>
            <div id="loginForm">
                <div class="form-group">
                    <label for="usernameInput"><i class="fas fa-user"></i> Username</label>
                    <input type="text" id="usernameInput" placeholder="Username" minlength="3" maxlength="20">
                </div>
                <div class="form-group">
                    <label for="passwordInput"><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="passwordInput" placeholder="Password" minlength="6">
                </div>
                <div class="modal-buttons">
                    <button id="registerBtn" class="btn-secondary">Register</button>
                    <button id="loginSubmitBtn" class="btn-primary">Login</button>
                </div>
                <p style="margin-top: 15px; color: rgba(255, 255, 255, 0.7);">
                    Or <a href="#" id="guestLink" style="color: #4cc9f0;">continue as guest</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Room Created Modal -->
    <div class="modal hidden" id="roomModal">
        <div class="modal-content">
            <h3><i class="fas fa-link"></i> Room Created!</h3>
            <p>Share this code with friends:</p>
            <div class="room-code-display" id="displayRoomCode">ABCD1234</div>
            <p class="room-url" id="roomUrl">http://localhost:3000?room=ABCD1234</p>
            <div class="modal-buttons">
                <button id="copyRoomCodeBtn" class="btn-primary">
                    <i class="fas fa-copy"></i> Copy
                </button>
                <button id="closeRoomModal" class="btn-secondary">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div class="modal hidden" id="gameOverModal">
        <div class="modal-content">
            <h3><i class="fas fa-trophy"></i> Game Over!</h3>
            <div id="gameResult"></div>
            <div id="pointsEarned"></div>
            <div class="modal-buttons">
                <button id="rematchBtn" class="btn-primary">
                    <i class="fas fa-redo"></i> Rematch
                </button>
                <button id="backToLobbyBtn" class="btn-secondary">
                    <i class="fas fa-home"></i> Lobby
                </button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // GAME MANAGEMENT SYSTEM (REAL-TIME)
        // ============================================

        class GameManager {
            constructor() {
                this.activeGames = JSON.parse(localStorage.getItem('chess_active_games')) || [];
                this.init();
            }

            init() {
                this.loadGames();
            }

            loadGames() {
                const storedGames = JSON.parse(localStorage.getItem('chess_active_games')) || [];
                
                if (storedGames.length === 0) {
                    this.generateSampleGames();
                } else {
                    this.activeGames = storedGames;
                }
            }

            generateSampleGames() {
                const sampleGames = [
                    {
                        id: 'game_' + Date.now(),
                        roomCode: 'CHESS' + Math.floor(100 + Math.random() * 900),
                        whitePlayer: 'Player' + Math.floor(Math.random() * 100),
                        blackPlayer: null,
                        status: 'waiting',
                        created: Date.now() - 300000,
                        maxTime: 600,
                        currentTime: 600
                    },
                    {
                        id: 'game_' + (Date.now() + 1),
                        roomCode: 'CHECK' + Math.floor(100 + Math.random() * 900),
                        whitePlayer: 'Grandmaster',
                        blackPlayer: 'ProPlayer',
                        status: 'playing',
                        created: Date.now() - 120000,
                        maxTime: 300,
                        currentTime: 240
                    }
                ];

                this.activeGames = sampleGames;
                this.saveGames();
            }

            createGame(whitePlayer) {
                const roomCode = this.generateRoomCode();
                const game = {
                    id: 'game_' + Date.now(),
                    roomCode: roomCode,
                    whitePlayer: whitePlayer,
                    blackPlayer: null,
                    status: 'waiting',
                    created: Date.now(),
                    maxTime: 600,
                    currentTime: 600,
                    fen: 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1'
                };

                this.activeGames.push(game);
                this.saveGames();
                this.broadcastGameUpdate();
                
                return game;
            }

            joinGame(gameId, blackPlayer) {
                const gameIndex = this.activeGames.findIndex(g => g.id === gameId);
                
                if (gameIndex === -1) {
                    return { success: false, message: 'Game tidak ditemukan' };
                }

                const game = this.activeGames[gameIndex];
                
                if (game.status !== 'waiting') {
                    return { success: false, message: 'Game sudah penuh' };
                }

                if (game.whitePlayer === blackPlayer) {
                    return { success: false, message: 'Tidak bisa join game sendiri' };
                }

                game.blackPlayer = blackPlayer;
                game.status = 'playing';
                game.started = Date.now();

                this.activeGames[gameIndex] = game;
                this.saveGames();
                this.broadcastGameUpdate();

                return { 
                    success: true, 
                    game: game,
                    message: 'Berhasil join game!'
                };
            }

            joinRandomGame(playerName) {
                const waitingGames = this.activeGames.filter(game => 
                    game.status === 'waiting' && 
                    game.whitePlayer !== playerName
                );

                if (waitingGames.length === 0) {
                    return { 
                        success: false, 
                        message: 'Tidak ada game yang tersedia' 
                    };
                }

                const randomGame = waitingGames[Math.floor(Math.random() * waitingGames.length)];
                return this.joinGame(randomGame.id, playerName);
            }

            joinRoom(roomCode, playerName) {
                const game = this.activeGames.find(g => 
                    g.roomCode === roomCode.toUpperCase()
                );

                if (!game) {
                    return { 
                        success: false, 
                        message: 'Room tidak ditemukan' 
                    };
                }

                return this.joinGame(game.id, playerName);
            }

            endGame(gameId, result) {
                const gameIndex = this.activeGames.findIndex(g => g.id === gameId);
                
                if (gameIndex === -1) return;

                this.activeGames.splice(gameIndex, 1);
                this.saveGames();
                this.broadcastGameUpdate();
            }

            generateRoomCode() {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let code = '';
                for (let i = 0; i < 6; i++) {
                    code += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return code;
            }

            saveGames() {
                localStorage.setItem('chess_active_games', JSON.stringify(this.activeGames));
            }

            broadcastGameUpdate() {
                if (window.chessApp) {
                    window.chessApp.updateGamesList();
                }
            }

            getAvailableGames() {
                return this.activeGames.filter(game => 
                    game.status === 'waiting' || game.status === 'playing'
                );
            }

            removeOldGames() {
                const now = Date.now();
                const oneHour = 60 * 60 * 1000;
                
                this.activeGames = this.activeGames.filter(game => {
                    if (game.status === 'playing') return true;
                    return (now - game.created) < oneHour;
                });
                
                this.saveGames();
                this.broadcastGameUpdate();
            }

            getGameById(gameId) {
                return this.activeGames.find(g => g.id === gameId);
            }

            getGameByRoomCode(roomCode) {
                return this.activeGames.find(g => g.roomCode === roomCode);
            }
        }

        // ============================================
        // USER MANAGEMENT SYSTEM (DENGAN ADMIN)
        // ============================================

        class UserManager {
            constructor() {
                this.currentUser = null;
                this.users = JSON.parse(localStorage.getItem('chess_users')) || {};
                this.init();
            }

            init() {
                if (!this.users['Admin']) {
                    this.users['Admin'] = {
                        username: 'Admin',
                        password: btoa('Rizz'),
                        points: 999999,
                        rank: 'Super Grandmaster',
                        games: { total: 999, won: 999, lost: 0, drawn: 0 },
                        clan: null,
                        joinedAt: new Date().toISOString(),
                        profilePic: null,
                        gameHistory: [],
                        isAdmin: true
                    };
                    localStorage.setItem('chess_users', JSON.stringify(this.users));
                }

                const guestData = localStorage.getItem('chess_guest');
                if (guestData) {
                    this.currentUser = JSON.parse(guestData);
                    this.updateUI();
                }
            }

            register(username, password) {
                if (this.users[username]) {
                    return { success: false, message: 'Username sudah ada!' };
                }
                
                const user = {
                    username,
                    password: btoa(password),
                    points: 0,
                    rank: 'Bronze',
                    games: { total: 0, won: 0, lost: 0, drawn: 0 },
                    clan: null,
                    joinedAt: new Date().toISOString(),
                    profilePic: null,
                    gameHistory: [],
                    isAdmin: false
                };
                
                this.users[username] = user;
                localStorage.setItem('chess_users', JSON.stringify(this.users));
                
                return { success: true, user };
            }

            login(username, password) {
                if (username === 'Admin' && password === 'Rizz') {
                    const adminUser = this.users['Admin'];
                    this.currentUser = adminUser;
                    localStorage.setItem('chess_current_user', JSON.stringify(adminUser));
                    return { success: true, user: adminUser };
                }

                const user = this.users[username];
                if (!user || user.password !== btoa(password)) {
                    return { success: false, message: 'Username/password salah!' };
                }
                
                this.currentUser = user;
                localStorage.setItem('chess_current_user', JSON.stringify(user));
                return { success: true, user };
            }

            loginAsGuest() {
                const guestId = 'Guest_' + Math.floor(Math.random() * 1000);
                const user = {
                    username: guestId,
                    points: 0,
                    rank: 'Bronze',
                    games: { total: 0, won: 0, lost: 0, drawn: 0 },
                    clan: null,
                    isGuest: true,
                    profilePic: null,
                    isAdmin: false
                };
                
                this.currentUser = user;
                localStorage.setItem('chess_guest', JSON.stringify(user));
                return user;
            }

            logout() {
                this.currentUser = null;
                localStorage.removeItem('chess_current_user');
                localStorage.removeItem('chess_guest');
            }

            updateUser(data) {
                if (!this.currentUser) return;
                
                Object.assign(this.currentUser, data);
                
                if (this.currentUser.isGuest) {
                    localStorage.setItem('chess_guest', JSON.stringify(this.currentUser));
                } else {
                    this.users[this.currentUser.username] = this.currentUser;
                    localStorage.setItem('chess_users', JSON.stringify(this.users));
                    localStorage.setItem('chess_current_user', JSON.stringify(this.currentUser));
                }
            }

            updateProfilePic(imageData) {
                if (!this.currentUser) return;
                
                this.currentUser.profilePic = imageData;
                this.updateUser({ profilePic: imageData });
                this.updateProfileImage();
            }

            updateProfileImage() {
                const profileImage = document.getElementById('profileImage');
                const headerProfilePic = document.getElementById('headerProfilePic');
                
                if (this.currentUser && this.currentUser.profilePic) {
                    profileImage.innerHTML = `<img src="${this.currentUser.profilePic}" style="width:100%;height:100%;border-radius:50%;">`;
                    headerProfilePic.innerHTML = `<img src="${this.currentUser.profilePic}" style="width:100%;height:100%;border-radius:50%;">`;
                } else {
                    profileImage.innerHTML = '<i class="fas fa-user"></i>';
                    headerProfilePic.innerHTML = '<i class="fas fa-user"></i>';
                }
            }

            calculateRank(points) {
                if (points >= 999999) return 'Super Grandmaster';
                if (points >= 1000) return 'Master';
                if (points >= 500) return 'Platinum';
                if (points >= 150) return 'Silver';
                return 'Bronze';
            }

            updateRank() {
                if (!this.currentUser) return;
                
                const oldRank = this.currentUser.rank;
                const newRank = this.calculateRank(this.currentUser.points);
                
                if (oldRank !== newRank) {
                    this.currentUser.rank = newRank;
                    this.updateUser({ rank: newRank });
                    
                    if (window.chessApp) {
                        window.chessApp.addChatMessage('System', 
                            `ðŸŽ‰ Rank up! Now: ${newRank}!`);
                    }
                }
            }

            addGameResult(result, pointsEarned = 0) {
                if (!this.currentUser) return;
                
                if (this.currentUser.isAdmin) {
                    result = 'win';
                    pointsEarned = 999;
                } else {
                    this.currentUser.games.total++;
                    
                    switch(result) {
                        case 'win':
                            this.currentUser.games.won++;
                            pointsEarned = 50;
                            // Bonus clan
                            if (this.currentUser.clan) {
                                pointsEarned += 10;
                            }
                            break;
                        case 'lose':
                            this.currentUser.games.lost++;
                            pointsEarned = -10;
                            break;
                        case 'draw':
                            this.currentUser.games.drawn++;
                            pointsEarned = 10;
                            break;
                    }
                }
                
                this.currentUser.points += pointsEarned;
                if (this.currentUser.points < 0) this.currentUser.points = 0;
                
                this.currentUser.gameHistory.unshift({
                    date: new Date().toISOString(),
                    result,
                    points: pointsEarned,
                    opponent: 'Player' + Math.floor(Math.random() * 1000),
                    pointsBefore: this.currentUser.points - pointsEarned
                });
                
                if (this.currentUser.gameHistory.length > 10) {
                    this.currentUser.gameHistory.pop();
                }
                
                this.updateUser({
                    games: this.currentUser.games,
                    points: this.currentUser.points,
                    gameHistory: this.currentUser.gameHistory
                });
                
                this.updateRank();
                return pointsEarned;
            }

            getWinRate() {
                if (!this.currentUser || this.currentUser.games.total === 0) return '0%';
                const rate = (this.currentUser.games.won / this.currentUser.games.total) * 100;
                return rate.toFixed(1) + '%';
            }

            updateUI() {
                if (!this.currentUser) {
                    document.getElementById('username').textContent = 'Guest';
                    document.getElementById('userRank').textContent = 'Bronze';
                    document.getElementById('userRank').className = 'user-rank rank-bronze';
                    document.getElementById('authBtn').innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
                    document.getElementById('toggleHintsBtn').classList.add('hidden');
                    document.getElementById('adminHints').classList.remove('show');
                    return;
                }
                
                document.getElementById('username').textContent = this.currentUser.username;
                document.getElementById('userRank').textContent = this.currentUser.rank;
                
                let rankClass = `user-rank rank-${this.currentUser.rank.toLowerCase().replace(' ', '').replace('super', 'supergrandmaster')}`;
                document.getElementById('userRank').className = rankClass;
                
                if (this.currentUser.isAdmin) {
                    if (!document.querySelector('.admin-badge')) {
                        const adminBadge = document.createElement('span');
                        adminBadge.className = 'admin-badge';
                        adminBadge.textContent = 'ADMIN';
                        document.getElementById('userDisplay').appendChild(adminBadge);
                    }
                    document.getElementById('toggleHintsBtn').classList.remove('hidden');
                } else {
                    const adminBadge = document.querySelector('.admin-badge');
                    if (adminBadge) adminBadge.remove();
                    document.getElementById('toggleHintsBtn').classList.add('hidden');
                    document.getElementById('adminHints').classList.remove('show');
                }
                
                document.getElementById('authBtn').innerHTML = '<i class="fas fa-sign-out-alt"></i> Logout';
                
                // Update profile section
                document.getElementById('profileUsername').textContent = this.currentUser.username;
                document.getElementById('memberSince').textContent = 
                    new Date(this.currentUser.joinedAt || new Date()).toLocaleDateString('id-ID');
                document.getElementById('profileRank').textContent = this.currentUser.rank;
                document.getElementById('profileRank').className = rankClass;
                
                document.getElementById('totalGames').textContent = this.currentUser.games.total;
                document.getElementById('gamesWon').textContent = this.currentUser.games.won;
                document.getElementById('gamesLost').textContent = this.currentUser.games.lost;
                document.getElementById('gamesDrawn').textContent = this.currentUser.games.drawn;
                document.getElementById('winRate').textContent = this.getWinRate();
                document.getElementById('currentPoints').textContent = this.currentUser.points;
                
                // Update points section
                document.getElementById('totalPoints').textContent = this.currentUser.points;
                
                this.updateProfileImage();
                this.updateRankProgress();
                
                // Update clan display
                if (window.chessApp) {
                    window.chessApp.updateClanDisplay();
                }
            }

            updateRankProgress() {
                const points = this.currentUser?.points || 0;
                const progressBar = document.getElementById('rankProgress');
                const rankStages = document.getElementById('rankStages');
                
                const ranks = [
                    { name: 'Bronze', threshold: 0, icon: 'ðŸ¥‰', points: '0-149' },
                    { name: 'Silver', threshold: 150, icon: 'ðŸ¥ˆ', points: '150-499' },
                    { name: 'Platinum', threshold: 500, icon: 'ðŸ¥‡', points: '500-999' },
                    { name: 'Master', threshold: 1000, icon: 'ðŸ‘‘', points: '1000+' },
                    { name: 'Super Grandmaster', threshold: 999999, icon: 'ðŸ†', points: '999999' }
                ];
                
                let currentRank, nextRank;
                for (let i = ranks.length - 1; i >= 0; i--) {
                    if (points >= ranks[i].threshold) {
                        currentRank = ranks[i];
                        nextRank = ranks[i + 1];
                        break;
                    }
                }
                
                if (!currentRank) currentRank = ranks[0];
                
                let progress = 0;
                if (nextRank) {
                    const range = nextRank.threshold - currentRank.threshold;
                    const currentProgress = points - currentRank.threshold;
                    progress = Math.min(100, (currentProgress / range) * 100);
                } else {
                    progress = 100;
                }
                
                progressBar.style.width = progress + '%';
                
                rankStages.innerHTML = '';
                ranks.forEach(rank => {
                    const stage = document.createElement('div');
                    stage.className = `rank-stage ${points >= rank.threshold ? 'active' : ''}`;
                    stage.innerHTML = `
                        <div class="rank-icon">${rank.icon}</div>
                        <div>${rank.name}</div>
                        <div class="rank-threshold">${rank.threshold}</div>
                    `;
                    rankStages.appendChild(stage);
                });
            }
        }

        // ============================================
        // CLAN MANAGEMENT SYSTEM
        // ============================================

        class ClanManager {
            constructor() {
                this.clans = JSON.parse(localStorage.getItem('chess_clans')) || {};
                this.init();
            }

            init() {
                // Buat beberapa clan contoh untuk demo
                if (Object.keys(this.clans).length === 0) {
                    this.createSampleClans();
                }
            }

            createSampleClans() {
                const sampleClans = [
                    {
                        id: 'clan_' + Date.now(),
                        name: 'Chess Masters',
                        creator: 'Admin',
                        members: ['Admin', 'Player1', 'Player2'],
                        points: 1500,
                        createdAt: Date.now(),
                        description: 'Untuk para master catur'
                    },
                    {
                        id: 'clan_' + (Date.now() + 1),
                        name: 'Pawn Pushers',
                        creator: 'Player3',
                        members: ['Player3', 'Player4'],
                        points: 800,
                        createdAt: Date.now() - 86400000,
                        description: 'Specialist pawn strategy'
                    }
                ];
                
                sampleClans.forEach(clan => {
                    this.clans[clan.id] = clan;
                });
                
                localStorage.setItem('chess_clans', JSON.stringify(this.clans));
            }

            createClan(name, creator) {
                const clanId = 'clan_' + Date.now();
                const clan = {
                    id: clanId,
                    name: name,
                    creator: creator,
                    members: [creator],
                    points: 0,
                    createdAt: Date.now(),
                    description: 'Clan baru yang dibentuk'
                };
                
                this.clans[clanId] = clan;
                localStorage.setItem('chess_clans', JSON.stringify(this.clans));
                
                return { success: true, clan: clan, message: `Clan "${name}" berhasil dibuat!` };
            }

            joinClan(clanId, username) {
                const clan = this.clans[clanId];
                if (!clan) {
                    return { success: false, message: 'Clan tidak ditemukan!' };
                }
                
                if (clan.members.includes(username)) {
                    return { success: false, message: 'Anda sudah bergabung dengan clan ini!' };
                }
                
                if (clan.members.length >= 20) {
                    return { success: false, message: 'Clan sudah penuh! (Max 20 anggota)' };
                }
                
                clan.members.push(username);
                localStorage.setItem('chess_clans', JSON.stringify(this.clans));
                
                return { 
                    success: true, 
                    message: `Berhasil bergabung dengan clan "${clan.name}"!`,
                    clan: clan
                };
            }

            leaveClan(clanId, username) {
                const clan = this.clans[clanId];
                if (!clan) return { success: false, message: 'Clan tidak ditemukan!' };
                
                if (!clan.members.includes(username)) {
                    return { success: false, message: 'Anda bukan anggota clan ini!' };
                }
                
                clan.members = clan.members.filter(member => member !== username);
                
                if (clan.members.length === 0) {
                    delete this.clans[clanId];
                } else if (clan.creator === username) {
                    clan.creator = clan.members[0];
                }
                
                localStorage.setItem('chess_clans', JSON.stringify(this.clans));
                
                return { 
                    success: true, 
                    message: `Berhasil keluar dari clan "${clan.name}"!`
                };
            }

            getClanById(clanId) {
                return this.clans[clanId];
            }

            getClanByMember(username) {
                for (const clanId in this.clans) {
                    if (this.clans[clanId].members.includes(username)) {
                        return this.clans[clanId];
                    }
                }
                return null;
            }

            getAllClans() {
                return Object.values(this.clans);
            }

            searchClans(query) {
                const allClans = this.getAllClans();
                const searchTerm = query.toLowerCase();
                
                return allClans.filter(clan => 
                    clan.name.toLowerCase().includes(searchTerm) ||
                    clan.id.toLowerCase().includes(searchTerm)
                );
            }

            addClanPoints(clanId, points) {
                const clan = this.clans[clanId];
                if (!clan) return false;
                
                clan.points += points;
                if (clan.points < 0) clan.points = 0;
                
                localStorage.setItem('chess_clans', JSON.stringify(this.clans));
                return true;
            }
        }

        // ============================================
        // CHESS GAME LOGIC
        // ============================================

        class ChessGame {
            constructor() {
                this.board = null;
                this.selectedSquare = null;
                this.possibleMoves = [];
                this.isWhite = true;
                this.myTurn = true;
                this.isAdmin = false;
                this.pieces = {
                    'k': 'â™”', 'q': 'â™•', 'r': 'â™–', 'b': 'â™—', 'n': 'â™˜', 'p': 'â™™',
                    'K': 'â™š', 'Q': 'â™›', 'R': 'â™œ', 'B': 'â™', 'N': 'â™ž', 'P': 'â™Ÿ'
                };
            }

            init(initialFEN = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1', isWhite = true, isAdmin = false) {
                this.isWhite = isWhite;
                this.isAdmin = isAdmin;
                this.createBoard();
                this.loadFEN(initialFEN);
                this.setupEventListeners();
                
                if (isAdmin) {
                    this.enableAdminFeatures();
                }
            }

            createBoard() {
                const board = document.getElementById('chessboard');
                board.innerHTML = '';
                
                for (let row = 0; row < 8; row++) {
                    for (let col = 0; col < 8; col++) {
                        const square = document.createElement('div');
                        square.className = `chess-square ${(row + col) % 2 === 0 ? 'light-square' : 'dark-square'}`;
                        square.dataset.row = row;
                        square.dataset.col = col;
                        square.dataset.position = `${String.fromCharCode(97 + col)}${8 - row}`;
                        
                        const displayRow = this.isWhite ? row : 7 - row;
                        const displayCol = this.isWhite ? col : 7 - col;
                        square.style.order = displayRow * 8 + displayCol;
                        
                        board.appendChild(square);
                    }
                }
                
                this.board = board;
            }

            loadFEN(fen) {
                const [piecePlacement] = fen.split(' ');
                const rows = piecePlacement.split('/');
                
                document.querySelectorAll('.chess-piece').forEach(piece => piece.remove());
                document.querySelectorAll('.possible-move').forEach(move => move.remove());
                
                rows.forEach((row, rowIndex) => {
                    let colIndex = 0;
                    for (const char of row) {
                        if (isNaN(char)) {
                            const square = this.getSquare(rowIndex, colIndex);
                            const piece = document.createElement('div');
                            piece.className = `chess-piece ${char === char.toLowerCase() ? 'black-piece' : 'white-piece'}`;
                            piece.textContent = this.pieces[char] || '?';
                            piece.dataset.piece = char;
                            square.appendChild(piece);
                            colIndex++;
                        } else {
                            colIndex += parseInt(char);
                        }
                    }
                });
            }

            getSquare(row, col) {
                const squares = this.board.querySelectorAll('.chess-square');
                const index = row * 8 + col;
                return squares[index];
            }

            showPossibleMoves(square) {
                this.clearPossibleMoves();
                
                const row = parseInt(square.dataset.row);
                const col = parseInt(square.dataset.col);
                
                let moves = [];
                const piece = square.querySelector('.chess-piece')?.dataset.piece;
                
                if (this.isAdmin && this.myTurn) {
                    moves = this.getAllPossibleMovesAdmin(row, col);
                } else {
                    moves = this.getNormalMoves(row, col, piece);
                }
                
                this.possibleMoves = moves;
                moves.forEach(([r, c]) => {
                    const moveMarker = document.createElement('div');
                    moveMarker.className = 'possible-move';
                    this.getSquare(r, c).appendChild(moveMarker);
                });
            }

            getAllPossibleMovesAdmin(row, col) {
                const moves = [];
                for (let r = 0; r < 8; r++) {
                    for (let c = 0; c < 8; c++) {
                        if (r !== row || c !== col) {
                            moves.push([r, c]);
                        }
                    }
                }
                return moves;
            }

            getNormalMoves(row, col, piece) {
                const moves = [];
                const directions = [
                    [1, 0], [-1, 0], [0, 1], [0, -1],
                    [1, 1], [1, -1], [-1, 1], [-1, -1],
                    [2, 1], [2, -1], [-2, 1], [-2, -1],
                    [1, 2], [1, -2], [-1, 2], [-1, -2]
                ];
                
                for (const [dr, dc] of directions) {
                    const newRow = row + dr;
                    const newCol = col + dc;
                    
                    if (newRow >= 0 && newRow < 8 && newCol >= 0 && newCol < 8) {
                        moves.push([newRow, newCol]);
                    }
                }
                return moves;
            }

            clearPossibleMoves() {
                document.querySelectorAll('.possible-move').forEach(move => move.remove());
                this.possibleMoves = [];
            }

            setupEventListeners() {
                this.board.addEventListener('click', (e) => {
                    const square = e.target.closest('.chess-square');
                    if (!square) return;
                    
                    const row = parseInt(square.dataset.row);
                    const col = parseInt(square.dataset.col);
                    
                    const piece = square.querySelector('.chess-piece');
                    if (piece && this.myTurn) {
                        this.clearSelection();
                        square.classList.add('selected');
                        this.selectedSquare = square;
                        this.showPossibleMoves(square);
                    } else if (this.selectedSquare && this.isPossibleMove(row, col)) {
                        this.movePiece(this.selectedSquare, square);
                    }
                });
            }

            isPossibleMove(row, col) {
                return this.possibleMoves.some(([r, c]) => r === row && c === col);
            }

            movePiece(fromSquare, toSquare) {
                const piece = fromSquare.querySelector('.chess-piece');
                if (!piece) return;
                
                fromSquare.removeChild(piece);
                
                const existingPiece = toSquare.querySelector('.chess-piece');
                if (existingPiece) {
                    toSquare.removeChild(existingPiece);
                }
                
                toSquare.appendChild(piece);
                
                this.clearSelection();
                this.clearPossibleMoves();
                
                this.myTurn = !this.myTurn;
                this.updateGameStatus();
                
                if (window.chessApp) {
                    const from = fromSquare.dataset.position;
                    const to = toSquare.dataset.position;
                    window.chessApp.sendMove(from, to);
                }
            }

            clearSelection() {
                document.querySelectorAll('.chess-square.selected').forEach(sq => {
                    sq.classList.remove('selected');
                });
                this.selectedSquare = null;
            }

            updateGameStatus() {
                const statusElement = document.getElementById('gameStatus');
                if (this.myTurn) {
                    statusElement.textContent = 'Your Turn';
                    statusElement.className = 'status-active';
                } else {
                    statusElement.textContent = "Opponent's Turn";
                    statusElement.className = 'status-waiting';
                }
            }

            enableAdminFeatures() {
                console.log('Admin features enabled!');
            }
        }

        // ============================================
        // MAIN APPLICATION
        // ============================================

        class ChessApp {
            constructor() {
                this.userManager = new UserManager();
                this.clanManager = new ClanManager();
                this.gameManager = new GameManager();
                this.currentGame = null;
                this.isWhite = false;
                this.game = new ChessGame();
                
                this.whiteTime = 600;
                this.blackTime = 600;
                this.timerInterval = null;
                
                this.init();
            }

            init() {
                this.bindEvents();
                this.updateGamesList();
                this.startRealTimeUpdates();
            }

            bindEvents() {
                // Auth
                document.getElementById('authBtn').addEventListener('click', () => {
                    if (this.userManager.currentUser) {
                        this.logout();
                    } else {
                        this.showLoginModal();
                    }
                });

                document.getElementById('loginSubmitBtn').addEventListener('click', () => this.login());
                document.getElementById('registerBtn').addEventListener('click', () => this.register());
                document.getElementById('guestLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.loginAsGuest();
                });

                // Bottom Navigation
                document.getElementById('navLobby').addEventListener('click', () => {
                    this.showSection('lobbySection');
                    this.setActiveNav('navLobby');
                });

                document.getElementById('navProfile').addEventListener('click', () => {
                    this.showSection('profileSection');
                    this.setActiveNav('navProfile');
                    this.updateProfile();
                });

                document.getElementById('navClan').addEventListener('click', () => {
                    this.showSection('clanSection');
                    this.setActiveNav('navClan');
                    this.updateClanDisplay();
                });

                document.getElementById('navPoints').addEventListener('click', () => {
                    this.showSection('pointsSection');
                    this.setActiveNav('navPoints');
                    this.updatePointsDisplay();
                });

                // Lobby
                document.getElementById('createGameBtn').addEventListener('click', () => this.createGame());
                document.getElementById('joinRandomBtn').addEventListener('click', () => this.joinRandomGame());
                document.getElementById('joinRoomBtn').addEventListener('click', () => this.joinRoom());
                document.getElementById('roomCodeInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.joinRoom();
                });

                // Profile Photo
                document.getElementById('changePhotoBtn').addEventListener('click', () => {
                    document.getElementById('photoUpload').click();
                });

                document.getElementById('photoUpload').addEventListener('change', (e) => {
                    this.handlePhotoUpload(e);
                });

                // Clan
                document.getElementById('createClanBtn').addEventListener('click', () => this.createClan());
                document.getElementById('joinClanBtn').addEventListener('click', () => this.joinClan());
                document.getElementById('leaveClanBtn').addEventListener('click', () => this.leaveClan());
                document.getElementById('inviteClanBtn').addEventListener('click', () => this.inviteToClan());
                
                // Clan ID Copy
                document.getElementById('clanIdDisplay').addEventListener('click', () => this.copyClanId());

                // Game Controls
                document.getElementById('resignBtn').addEventListener('click', () => this.resignGame());
                document.getElementById('offerDrawBtn').addEventListener('click', () => this.offerDraw());
                document.getElementById('newGameBtn').addEventListener('click', () => this.newGame());

                // Chat
                document.getElementById('sendChatBtn').addEventListener('click', () => this.sendChat());
                document.getElementById('chatInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.sendChat();
                });

                // Modals
                document.getElementById('copyRoomCodeBtn').addEventListener('click', () => this.copyRoomCode());
                document.getElementById('closeRoomModal').addEventListener('click', () => this.hideRoomModal());

                // Game Over
                document.getElementById('rematchBtn').addEventListener('click', () => this.newGame());
                document.getElementById('backToLobbyBtn').addEventListener('click', () => this.backToLobby());

                // Admin Hints Toggle
                document.getElementById('toggleHintsBtn').addEventListener('click', () => this.toggleAdminHints());

                // Adjust layout on resize
                window.addEventListener('resize', () => this.adjustLayout());
                this.adjustLayout();
            }

            adjustLayout() {
                // Adjust chessboard size based on available space
                const container = document.querySelector('.chessboard-container');
                if (!container) return;
                
                const availableHeight = window.innerHeight - 200;
                const availableWidth = window.innerWidth;
                
                let boardSize = 480;
                
                if (availableHeight < 500 || availableWidth < 800) {
                    boardSize = 400;
                }
                
                if (availableHeight < 400 || availableWidth < 600) {
                    boardSize = 320;
                }
                
                if (availableHeight < 350 || availableWidth < 500) {
                    boardSize = 280;
                }
                
                const chessboard = document.getElementById('chessboard');
                if (chessboard) {
                    chessboard.style.width = boardSize + 'px';
                    chessboard.style.height = boardSize + 'px';
                    
                    const squareSize = boardSize / 8;
                    chessboard.style.gridTemplateColumns = `repeat(8, ${squareSize}px)`;
                    chessboard.style.gridTemplateRows = `repeat(8, ${squareSize}px)`;
                    
                    document.querySelectorAll('.chess-square').forEach(square => {
                        square.style.width = squareSize + 'px';
                        square.style.height = squareSize + 'px';
                        square.style.fontSize = (squareSize * 0.6) + 'px';
                    });
                    
                    document.querySelectorAll('.possible-move').forEach(move => {
                        move.style.width = (squareSize * 0.3) + 'px';
                        move.style.height = (squareSize * 0.3) + 'px';
                        move.style.top = (squareSize * 0.35) + 'px';
                        move.style.left = (squareSize * 0.35) + 'px';
                    });
                }
            }

            showSection(sectionId) {
                document.getElementById('lobbySection').classList.add('hidden');
                document.getElementById('profileSection').classList.add('hidden');
                document.getElementById('clanSection').classList.add('hidden');
                document.getElementById('pointsSection').classList.add('hidden');
                document.getElementById('gameSection').classList.add('hidden');
                
                document.getElementById(sectionId).classList.remove('hidden');
                this.adjustLayout();
            }

            setActiveNav(navId) {
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.getElementById(navId).classList.add('active');
            }

            toggleAdminHints() {
                const hintsPanel = document.getElementById('adminHints');
                hintsPanel.classList.toggle('show');
            }

            showLoginModal() {
                document.getElementById('loginModal').classList.remove('hidden');
                document.getElementById('usernameInput').focus();
            }

            hideLoginModal() {
                document.getElementById('loginModal').classList.add('hidden');
                document.getElementById('usernameInput').value = '';
                document.getElementById('passwordInput').value = '';
            }

            login() {
                const username = document.getElementById('usernameInput').value.trim();
                const password = document.getElementById('passwordInput').value.trim();
                
                if (!username || !password) {
                    alert('Isi username & password!');
                    return;
                }
                
                const result = this.userManager.login(username, password);
                if (result.success) {
                    this.userManager.updateUI();
                    this.hideLoginModal();
                    this.addChatMessage('System', `Welcome ${username}! ${result.user.isAdmin ? '(ADMIN)' : ''}`);
                    
                    if (result.user.isAdmin) {
                        this.addChatMessage('System', 'ðŸŽ® Admin mode activated! You have special powers!');
                    }
                } else {
                    alert(result.message);
                }
            }

            register() {
                const username = document.getElementById('usernameInput').value.trim();
                const password = document.getElementById('passwordInput').value.trim();
                
                if (username.length < 3) {
                    alert('Username min 3 karakter!');
                    return;
                }
                
                if (password.length < 6) {
                    alert('Password min 6 karakter!');
                    return;
                }
                
                if (username.toLowerCase() === 'admin') {
                    alert('Username "Admin" is reserved!');
                    return;
                }
                
                const result = this.userManager.register(username, password);
                if (result.success) {
                    this.userManager.currentUser = result.user;
                    this.userManager.updateUI();
                    this.hideLoginModal();
                    this.addChatMessage('System', `Account created, ${username}!`);
                } else {
                    alert(result.message);
                }
            }

            loginAsGuest() {
                this.userManager.loginAsGuest();
                this.userManager.updateUI();
                this.hideLoginModal();
                this.addChatMessage('System', 'Playing as guest!');
            }

            logout() {
                if (confirm('Logout?')) {
                    this.userManager.logout();
                    this.userManager.updateUI();
                    this.addChatMessage('System', 'Logged out!');
                    this.showSection('lobbySection');
                    this.setActiveNav('navLobby');
                }
            }

            handlePhotoUpload(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                if (!file.type.startsWith('image/')) {
                    alert('File harus gambar!');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    this.userManager.updateProfilePic(e.target.result);
                };
                reader.readAsDataURL(file);
                
                event.target.value = '';
            }

            createGame() {
                if (!this.userManager.currentUser) {
                    alert('Login dulu bro!');
                    this.showLoginModal();
                    return;
                }
                
                const game = this.gameManager.createGame(this.userManager.currentUser.username);
                this.showRoomCreated(game.roomCode);
                
                this.startGame({
                    roomCode: game.roomCode,
                    whitePlayer: game.whitePlayer,
                    blackPlayer: null,
                    fen: game.fen
                });
            }

            joinRandomGame() {
                if (!this.userManager.currentUser) {
                    alert('Login dulu bro!');
                    this.showLoginModal();
                    return;
                }
                
                const result = this.gameManager.joinRandomGame(this.userManager.currentUser.username);
                
                if (result.success) {
                    this.startGame(result.game);
                    alert(result.message);
                } else {
                    alert(result.message);
                }
            }

            joinRoom(roomCode = null) {
                if (!this.userManager.currentUser) {
                    alert('Login dulu bro!');
                    this.showLoginModal();
                    return;
                }
                
                if (!roomCode) {
                    roomCode = document.getElementById('roomCodeInput').value.trim().toUpperCase();
                }
                
                if (!roomCode || roomCode.length < 4) {
                    alert('Kode room ga valid!');
                    return;
                }
                
                const result = this.gameManager.joinRoom(roomCode, this.userManager.currentUser.username);
                
                if (result.success) {
                    this.startGame(result.game);
                    alert(result.message);
                    document.getElementById('roomCodeInput').value = '';
                } else {
                    alert(result.message);
                }
            }

            showRoomCreated(roomCode) {
                document.getElementById('displayRoomCode').textContent = roomCode;
                document.getElementById('roomUrl').textContent = 
                    `${window.location.origin}?room=${roomCode}`;
                document.getElementById('roomModal').classList.remove('hidden');
            }

            hideRoomModal() {
                document.getElementById('roomModal').classList.add('hidden');
            }

            copyRoomCode() {
                const roomCode = document.getElementById('displayRoomCode').textContent;
                navigator.clipboard.writeText(roomCode).then(() => {
                    const btn = document.getElementById('copyRoomCodeBtn');
                    const originalText = btn.innerHTML;
                    btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                    }, 2000);
                });
            }

            startGame(gameData) {
                this.currentGame = gameData;
                this.isWhite = gameData.whitePlayer === this.userManager.currentUser?.username;
                const isAdmin = this.userManager.currentUser?.isAdmin || false;
                
                this.showSection('gameSection');
                this.setActiveNav('');
                
                document.getElementById('gameTitle').textContent = 
                    `Chess: ${gameData.whitePlayer} vs ${gameData.blackPlayer || 'Waiting...'}`;
                document.getElementById('roomCode').textContent = `Room: ${gameData.roomCode}`;
                
                document.getElementById('whitePlayer').textContent = gameData.whitePlayer;
                document.getElementById('blackPlayer').textContent = gameData.blackPlayer || 'Waiting...';
                
                this.game.init(gameData.fen, this.isWhite, isAdmin);
                this.game.myTurn = this.isWhite && gameData.blackPlayer;
                this.game.updateGameStatus();
                
                this.startTimer();
                
                if (gameData.blackPlayer) {
                    this.addChatMessage('System', 'Game started! White moves first.');
                    if (isAdmin) {
                        this.addChatMessage('System', 'ðŸ’¡ Admin hints are available! Click the lightbulb button.');
                    }
                } else {
                    this.addChatMessage('System', 'Waiting for opponent to join...');
                }
                
                document.getElementById('movesList').innerHTML = '';
                this.hideRoomModal();
                this.adjustLayout();
            }

            sendMove(from, to) {
                console.log(`Move: ${from} to ${to}`);
                this.addMoveToHistory(from, to);
            }

            addMoveToHistory(from, to) {
                const movesList = document.getElementById('movesList');
                const moves = movesList.querySelectorAll('.move-item');
                const moveNumber = Math.floor(moves.length / 2) + 1;
                
                if (moves.length % 2 === 0) {
                    const moveItem = document.createElement('div');
                    moveItem.className = 'move-item fade-in';
                    moveItem.innerHTML = `<span class="move-number">${moveNumber}.</span> ${from}${to}`;
                    movesList.appendChild(moveItem);
                } else {
                    const lastMove = moves[moves.length - 1];
                    lastMove.innerHTML += ` ${from}${to}`;
                }
                
                movesList.scrollTop = movesList.scrollHeight;
            }

            startTimer() {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                }
                
                this.timerInterval = setInterval(() => {
                    if (this.game.myTurn) {
                        this.whiteTime--;
                    } else {
                        this.blackTime--;
                    }
                    
                    this.updateTimers();
                    
                    if (this.whiteTime <= 0) {
                        this.gameOver('Black wins (time)', 'lose');
                    } else if (this.blackTime <= 0) {
                        this.gameOver('White wins (time)', 'win');
                    }
                }, 1000);
            }

            updateTimers() {
                const formatTime = (seconds) => {
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                };
                
                document.getElementById('whiteTimer').textContent = formatTime(this.whiteTime);
                document.getElementById('blackTimer').textContent = formatTime(this.blackTime);
                
                if (this.whiteTime < 60) {
                    document.getElementById('whiteTimer').classList.add('status-check');
                } else {
                    document.getElementById('whiteTimer').classList.remove('status-check');
                }
                
                if (this.blackTime < 60) {
                    document.getElementById('blackTimer').classList.add('status-check');
                } else {
                    document.getElementById('blackTimer').classList.remove('status-check');
                }
            }

            sendChat() {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                
                if (message) {
                    const username = this.userManager.currentUser?.username || 'Guest';
                    this.addChatMessage(username, message);
                    input.value = '';
                }
            }

            addChatMessage(username, message) {
                const chatMessages = document.getElementById('chatMessages');
                const messageElement = document.createElement('div');
                messageElement.className = 'chat-message fade-in';
                
                const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                messageElement.innerHTML = `
                    <span class="username">${username}:</span>
                    <span class="message">${message}</span>
                    <span class="time">${time}</span>
                `;
                
                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            resignGame() {
                if (confirm('Yakin mau nyerah?')) {
                    const result = this.isWhite ? 'lose' : 'win';
                    this.gameOver(
                        this.isWhite ? 'Black wins (resign)' : 'White wins (resign)',
                        result
                    );
                }
            }

            offerDraw() {
                alert('Draw offer sent!');
            }

            newGame() {
                this.whiteTime = 600;
                this.blackTime = 600;
                this.updateTimers();
                
                const isAdmin = this.userManager.currentUser?.isAdmin || false;
                this.game.init('rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1', this.isWhite, isAdmin);
                this.game.myTurn = this.isWhite;
                this.game.updateGameStatus();
                
                document.getElementById('movesList').innerHTML = '';
                
                document.getElementById('chatMessages').innerHTML = `
                    <div class="chat-message">
                        <span class="username">System:</span>
                        <span class="message">New game started!</span>
                        <span class="time">${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>
                    </div>
                `;
                
                document.getElementById('gameOverModal').classList.add('hidden');
                this.addChatMessage('System', 'New game!');
            }

            gameOver(resultMessage, result) {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                }
                
                let pointsEarned = 0;
                if (this.userManager.currentUser) {
                    pointsEarned = this.userManager.addGameResult(result);
                    
                    // Add clan points if in clan
                    if (this.userManager.currentUser.clan && pointsEarned > 0) {
                        this.clanManager.addClanPoints(this.userManager.currentUser.clan, Math.floor(pointsEarned / 2));
                    }
                }
                
                document.getElementById('gameResult').innerHTML = `
                    <h2 style="color: #f8961e; margin: 20px 0;">${resultMessage}</h2>
                `;
                
                document.getElementById('pointsEarned').innerHTML = pointsEarned >= 0 ?
                    `<p style="color: #4cc9f0; font-size: 1.2rem;">ðŸŽ‰ +${pointsEarned} points!</p>` :
                    `<p style="color: #f72585; font-size: 1.2rem;">ðŸ“‰ ${pointsEarned} points</p>`;
                
                document.getElementById('gameOverModal').classList.remove('hidden');
                this.addChatMessage('System', `Game over! ${resultMessage}`);
                
                if (this.currentGame && this.currentGame.roomCode) {
                    const game = this.gameManager.getGameByRoomCode(this.currentGame.roomCode);
                    if (game) {
                        this.gameManager.endGame(game.id, result);
                    }
                }
            }

            backToLobby() {
                this.showSection('lobbySection');
                this.setActiveNav('navLobby');
                document.getElementById('gameOverModal').classList.add('hidden');
                
                this.whiteTime = 600;
                this.blackTime = 600;
                this.updateTimers();
                
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                }
            }

            updateGamesList() {
                const games = this.gameManager.getAvailableGames();
                const gamesList = document.getElementById('gamesList');
                
                gamesList.innerHTML = '';
                
                if (games.length === 0) {
                    gamesList.innerHTML = `
                        <div class="no-games">
                            <i class="fas fa-chess-board fa-2x"></i>
                            <p>Tidak ada game yang tersedia</p>
                            <p>Buat game baru untuk memulai!</p>
                        </div>
                    `;
                    return;
                }
                
                games.forEach(game => {
                    const timeAgo = this.getTimeAgo(game.created);
                    const gameCard = document.createElement('div');
                    gameCard.className = 'game-card fade-in';
                    gameCard.dataset.gameId = game.id;
                    
                    gameCard.innerHTML = `
                        <h4>Room: ${game.roomCode}</h4>
                        <p>White: ${game.whitePlayer}</p>
                        <p>Black: ${game.blackPlayer || 'Waiting...'}</p>
                        <div class="game-meta">
                            <span class="game-status ${game.status === 'waiting' ? 'status-waiting' : 'status-playing'}">
                                ${game.status === 'waiting' ? 'Waiting' : 'Playing'}
                            </span>
                            <span>${timeAgo}</span>
                        </div>
                    `;
                    
                    gameCard.addEventListener('click', () => {
                        if (game.status === 'waiting' && game.whitePlayer !== this.userManager.currentUser?.username) {
                            document.getElementById('roomCodeInput').value = game.roomCode;
                            this.joinRoom(game.roomCode);
                        } else {
                            document.getElementById('roomCodeInput').value = game.roomCode;
                        }
                    });
                    
                    gamesList.appendChild(gameCard);
                });
            }

            getTimeAgo(timestamp) {
                const now = Date.now();
                const diff = now - timestamp;
                
                const minutes = Math.floor(diff / 60000);
                const hours = Math.floor(diff / 3600000);
                
                if (minutes < 1) return 'Baru saja';
                if (minutes < 60) return `${minutes} menit lalu`;
                if (hours < 24) return `${hours} jam lalu`;
                return `${Math.floor(hours / 24)} hari lalu`;
            }

            updateProfile() {
                if (!this.userManager.currentUser) return;
                this.userManager.updateUI();
            }

            updateClanDisplay() {
                if (!this.userManager.currentUser) return;
                
                const userClan = this.clanManager.getClanByMember(this.userManager.currentUser.username);
                const myClanSection = document.getElementById('myClanSection');
                const noClanSection = document.getElementById('noClanSection');
                const clanName = document.getElementById('clanName');
                const clanMembers = document.getElementById('clanMembers');
                const clanIdText = document.getElementById('clanIdText');
                const clanMembersList = document.getElementById('clanMembersList');
                
                if (userClan) {
                    myClanSection.classList.remove('hidden');
                    noClanSection.classList.add('hidden');
                    
                    clanName.textContent = userClan.name;
                    clanMembers.textContent = `${userClan.members.length} anggota`;
                    clanIdText.textContent = userClan.id;
                    
                    // Update members list
                    clanMembersList.innerHTML = '';
                    userClan.members.forEach(member => {
                        const memberCard = document.createElement('div');
                        memberCard.className = 'member-card fade-in';
                        memberCard.innerHTML = `
                            <div class="member-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="member-info">
                                <div class="member-name">${member}</div>
                                <div class="member-role">${member === userClan.creator ? 'ðŸ‘‘ Founder' : 'Member'}</div>
                            </div>
                        `;
                        clanMembersList.appendChild(memberCard);
                    });
                    
                    // Update user clan data
                    this.userManager.currentUser.clan = userClan.id;
                    this.userManager.updateUser({ clan: userClan.id });
                } else {
                    myClanSection.classList.add('hidden');
                    noClanSection.classList.remove('hidden');
                    
                    clanName.textContent = 'Tidak Ada Clan';
                    clanMembers.textContent = 'Belum bergabung dengan clan';
                    
                    // Clear user clan data
                    this.userManager.currentUser.clan = null;
                    this.userManager.updateUser({ clan: null });
                }
            }

            createClan() {
                if (!this.userManager.currentUser) {
                    alert('Login dulu bro!');
                    this.showLoginModal();
                    return;
                }
                
                const clanName = document.getElementById('clanNameInput').value.trim();
                if (!clanName) {
                    alert('Masukkan nama clan!');
                    return;
                }
                
                if (clanName.length < 3) {
                    alert('Nama clan minimal 3 karakter!');
                    return;
                }
                
                const result = this.clanManager.createClan(clanName, this.userManager.currentUser.username);
                if (result.success) {
                    this.userManager.currentUser.clan = result.clan.id;
                    this.userManager.updateUser({ clan: result.clan.id });
                    this.updateClanDisplay();
                    alert(result.message);
                    document.getElementById('clanNameInput').value = '';
                }
            }

            joinClan() {
                if (!this.userManager.currentUser) {
                    alert('Login dulu bro!');
                    this.showLoginModal();
                    return;
                }
                
                const clanId = document.getElementById('joinClanId').value.trim();
                if (!clanId) {
                    alert('Masukkan ID clan!');
                    return;
                }
                
                const result = this.clanManager.joinClan(clanId, this.userManager.currentUser.username);
                if (result.success) {
                    this.userManager.currentUser.clan = clanId;
                    this.userManager.updateUser({ clan: clanId });
                    this.updateClanDisplay();
                    alert(result.message);
                    document.getElementById('joinClanId').value = '';
                } else {
                    alert(result.message);
                }
            }

            leaveClan() {
                if (!this.userManager.currentUser || !this.userManager.currentUser.clan) {
                    alert('Anda tidak berada dalam clan!');
                    return;
                }
                
                if (!confirm('Yakin ingin keluar dari clan?')) {
                    return;
                }
                
                const result = this.clanManager.leaveClan(this.userManager.currentUser.clan, this.userManager.currentUser.username);
                if (result.success) {
                    this.userManager.currentUser.clan = null;
                    this.userManager.updateUser({ clan: null });
                    this.updateClanDisplay();
                    alert(result.message);
                } else {
                    alert(result.message);
                }
            }

            inviteToClan() {
                if (!this.userManager.currentUser || !this.userManager.currentUser.clan) {
                    alert('Anda tidak berada dalam clan!');
                    return;
                }
                
                const clan = this.clanManager.getClanById(this.userManager.currentUser.clan);
                if (!clan) return;
                
                const inviteMessage = `Join clan saya: ${clan.name}\nClan ID: ${clan.id}\nSalin ID ini dan paste di bagian "Gabung ke Clan"`;
                navigator.clipboard.writeText(`Clan ID: ${clan.id}`).then(() => {
                    alert('Clan ID telah disalin ke clipboard!\n' + inviteMessage);
                });
            }

            copyClanId() {
                if (!this.userManager.currentUser || !this.userManager.currentUser.clan) return;
                
                const clan = this.clanManager.getClanById(this.userManager.currentUser.clan);
                if (!clan) return;
                
                navigator.clipboard.writeText(clan.id).then(() => {
                    alert(`Clan ID "${clan.id}" telah disalin!`);
                });
            }

            updatePointsDisplay() {
                if (!this.userManager.currentUser) return;
                this.userManager.updateRankProgress();
            }

            startRealTimeUpdates() {
                setInterval(() => {
                    this.updateGamesList();
                }, 5000);
                
                setInterval(() => {
                    this.gameManager.removeOldGames();
                }, 60000);
            }
        }

        // ============================================
        // INITIALIZE APPLICATION
        // ============================================

        document.addEventListener('DOMContentLoaded', () => {
            window.chessApp = new ChessApp();
            
            if (!localStorage.getItem('chess_guest') && !localStorage.getItem('chess_current_user')) {
                setTimeout(() => {
                    window.chessApp.showLoginModal();
                }, 1000);
            }
        });

        // Fullscreen handling
        document.addEventListener('fullscreenchange', () => {
            if (window.chessApp) {
                window.chessApp.adjustLayout();
            }
        });

        document.addEventListener('webkitfullscreenchange', () => {
            if (window.chessApp) {
                window.chessApp.adjustLayout();
            }
        });

        document.addEventListener('mozfullscreenchange', () => {
            if (window.chessApp) {
                window.chessApp.adjustLayout();
            }
        });

        document.addEventListener('MSFullscreenChange', () => {
            if (window.chessApp) {
                window.chessApp.adjustLayout();
            }
        });
    </script>
</body>
</html>